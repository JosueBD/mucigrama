<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crucigrama Teórico Musical</title>
    <link href="./output.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 900px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .crossword-grid {
            display: grid;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            overflow: hidden;
        }
        .grid-cell {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            font-weight: bold;
            text-transform: uppercase;
            border: 1px solid #d1d5db;
            background-color: #e2e8f0;
            color: #333;
            position: relative;
        }
        /* ESTILO PARA CELDAS NEGRAS */
        .grid-cell.black {
            background-color: #2d3748; /* Un gris oscuro */
            border: 1px solid #4a5568; /* Borde más oscuro */
        }
        .grid-cell input {
            width: 100%;
            height: 100%;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            text-transform: uppercase;
            border: none;
            background-color: transparent;
            outline: none;
            color: #1a202c;
            padding: 0;
            box-sizing: border-box;
        }
        .grid-cell.active input {
            background-color: #bfdbfe; /* Tailwind blue-200 */
        }
        .grid-cell.correct input {
            background-color: #d1fae5; /* Tailwind green-100 */
        }
        .grid-cell.incorrect input {
            background-color: #fee2e2; /* Tailwind red-100 */
        }
        .grid-cell .number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 0.7em;
            color: #6b7280;
        }
        .clues-section {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .clues-column {
            flex: 1;
            min-width: 280px;
        }
        .clues-column h3 {
            font-size: 1.25em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #3b82f6;
        }
        .clues-column ol {
            list-style: none;
            padding-left: 0;
        }
        .clues-column li {
            margin-bottom: 5px;
            font-size: 0.95em;
            color: #4a5568;
            padding: 5px 0;
            border-bottom: 1px dashed #e2e8f0;
        }
        .clues-column li.active {
            background-color: #e0f2fe; /* Tailwind blue-50 */
            border-radius: 5px;
            padding-left: 10px;
            border-left: 3px solid #3b82f6;
        }
        .message-box {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            max-width: 400px;
            width: 90%;
            display: none; /* Hidden by default */
        }
        .message-box h4 {
            font-size: 1.5em;
            color: #3b82f6;
            margin-bottom: 15px;
        }
        .message-box p {
            margin-bottom: 20px;
            color: #4a5568;
        }
        .message-box button {
            background-color: #3b82f6;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .message-box button:hover {
            background-color: #2563eb;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                padding: 20px;
            }
            .crossword-grid {
                width: 100%;
                overflow-x: auto; /* Allow horizontal scrolling for smaller grids */
            }
            .grid-cell {
                width: 30px;
                height: 30px;
                font-size: 1em;
            }
            .grid-cell .number {
                font-size: 0.6em;
            }
            .grid-cell input {
                font-size: 1em;
            }
            .clues-section {
                flex-direction: column;
            }
            .clues-column {
                min-width: unset;
                width: 100%;
            }
        }
    </style>
    <link rel="manifest" href="./manifest.json">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-5">
    <div class="container">
        <h1 class="text-3xl font-extrabold text-center text-blue-600 mb-6 rounded-lg p-3 bg-blue-50 shadow-md">Crucigrama Teórico Musical</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="crossword-container flex justify-center items-center">
                <div id="crossword-grid" class="crossword-grid">
                </div>
            </div>

            <div class="clues-section">
                <div class="clues-column">
                    <h3 class="text-blue-600">Horizontales</h3>
                    <ol id="across-clues"></ol>
                </div>
                <div class="clues-column">
                    <h3 class="text-blue-600">Verticales</h3>
                    <ol id="down-clues"></ol>
                </div>
            </div>
        </div>

        <div class="buttons-container flex justify-center gap-4 mt-6">
            <button id="check-answers" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                Comprobar Respuestas
            </button>
            <button id="clear-grid" class="bg-red-500 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                Limpiar Crucigrama
            </button>
            <button id="show-solution" class="bg-green-500 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                Mostrar Solución
            </button>
        </div>
    </div>

    <div id="message-box" class="message-box">
        <h4 id="message-title"></h4>
        <p id="message-content"></p>
        <button id="message-ok-button">OK</button>
    </div>

    <script>
        // Define the crossword puzzle data
        const crosswordData = {
            // ESTA ES LA DATA CORREGIDA Y COHERENTE
            words: [
                // HORIZONTALES
                { word: 'MELODIA', clue: 'Sucesión de sonidos que forman una unidad musical.', start: { row: 0, col: 0 }, direction: 'across', number: 1 },
                { word: 'RITMO', clue: 'Orden y proporción en el movimiento o sucesión de los sonidos.', start: { row: 2, col: 1 }, direction: 'across', number: 2 },
                { word: 'ARMONIA', clue: 'Combinación de sonidos simultáneos que resultan agradables.', start: { row: 4, col: 0 }, direction: 'across', number: 3 },
                { word: 'TONO', clue: 'Altura de un sonido.', start: { row: 6, col: 2 }, direction: 'across', number: 4 },
                { word: 'COMPAS', clue: 'División de la música en partes iguales de tiempo.', start: { row: 8, col: 1 }, direction: 'across', number: 5 },

                // VERTICALES
                { word: 'NOTAS', clue: 'Signos que representan los sonidos musicales.', start: { row: 0, col: 4 }, direction: 'down', number: 10 },
                { word: 'TIMBRE', clue: 'Cualidad del sonido que permite distinguir la fuente sonora.', start: { row: 0, col: 6 }, direction: 'down', number: 6 },
                { word: 'ESCALA', clue: 'Sucesión de sonidos ascendentes o descendentes.', start: { row: 3, col: 0 }, direction: 'down', number: 7 },
                { word: 'ACORDE', clue: 'Conjunto de tres o más notas que suenan simultáneamente.', start: { row: 4, col: 3 }, direction: 'down', number: 8 },
                { word: 'SILENCIO', clue: 'Ausencia de sonido en la música.', start: { row: 2, col: 2 }, direction: 'down', number: 9 }
            ]
        };

        const crosswordGridElement = document.getElementById('crossword-grid');
        const acrossCluesElement = document.getElementById('across-clues');
        const downCluesElement = document.getElementById('down-clues');
        const checkAnswersButton = document.getElementById('check-answers');
        const clearGridButton = document.getElementById('clear-grid');
        const showSolutionButton = document.getElementById('show-solution');
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageContent = document.getElementById('message-content');
        const messageOkButton = document.getElementById('message-ok-button');
        let gridCells = [];
        let gridWidth = 0;
        let gridHeight = 0;
        let activeWord = null;

        function showMessage(title, content) {
            messageTitle.textContent = title;
            messageContent.textContent = content;
            messageBox.style.display = 'block';
        }

        messageOkButton.addEventListener('click', () => {
            messageBox.style.display = 'none';
        });

        function initializeGrid() {
            let maxRow = 0;
            let maxCol = 0;

            // Paso 1: Determinar el tamaño máximo de la cuadrícula
            crosswordData.words.forEach(word => {
                if (word.direction === 'across') {
                    maxCol = Math.max(maxCol, word.start.col + word.word.length - 1);
                    maxRow = Math.max(maxRow, word.start.row);
                } else {
                    maxRow = Math.max(maxRow, word.start.row + word.word.length - 1);
                    maxCol = Math.max(maxCol, word.start.col);
                }
            });
            gridWidth = maxCol + 1; // +1 porque el índice es base 0
            gridHeight = maxRow + 1; // +1 porque el índice es base 0

            // Paso 2: Crear una matriz bidimensional para almacenar el estado de la cuadrícula (letras reales)
            const grid = Array(gridHeight).fill(0).map(() => Array(gridWidth).fill(null));
            const playableCells = new Set(); // Para llevar un registro de qué celdas son parte de una palabra

            // Paso 3: Llenar la matriz 'grid' con las letras correctas de las palabras
            crosswordData.words.forEach(word => {
                let { row, col } = word.start;
                for (let i = 0; i < word.word.length; i++) {
                    // Aunque ajustamos maxRow/Col, es bueno tener esta seguridad.
                    if (row >= gridHeight) gridHeight = row + 1;
                    if (col >= gridWidth) gridWidth = col + 1;

                    const currentChar = word.word[i].toUpperCase();

                    if (grid[row][col] === null) {
                        grid[row][col] = currentChar;
                    } else if (grid[row][col] !== currentChar) {
                        console.warn(`Conflicto de letras en (${row}, ${col}). La palabra "${word.word}" intentó poner '${currentChar}', pero ya hay '${grid[row][col]}'. Revisa tu crosswordData.`);
                        // En un entorno de producción, aquí podrías querer detener el juego o mostrar un error.
                        // Por ahora, mantendremos la letra existente para evitar que el juego se rompa.
                    }
                    playableCells.add(`${row}-${col}`);
                    
                    if (word.direction === 'across') {
                        col++;
                    } else {
                        row++;
                    }
                }
            });

            // Ajustar el tamaño del contenedor del grid para CSS Grid
            crosswordGridElement.style.gridTemplateColumns = `repeat(${gridWidth}, 1fr)`;
            crosswordGridElement.innerHTML = ''; // Limpiar cualquier contenido anterior
            gridCells = []; // Reiniciar la lista de inputs para el nuevo grid

            // Paso 4: Generar los elementos HTML basados en la matriz 'grid' y 'playableCells'
            for (let r = 0; r < gridHeight; r++) {
                for (let c = 0; c < gridWidth; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell');
                    
                    // Solo si la celda es jugable (parte de una palabra)
                    if (playableCells.has(`${r}-${c}`)) {
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.maxLength = 1;
                        input.dataset.row = r;
                        input.dataset.col = c;
                        // NO rellenar el input aquí con la letra. Debe estar vacío al inicio.
                        
                        input.addEventListener('input', handleInput);
                        input.addEventListener('focus', handleFocus);
                        input.addEventListener('keydown', handleKeyDown);
                        cell.appendChild(input);
                        gridCells.push(input); // Añadir a la lista de inputs
                    } else {
                        // Si la celda NO es parte de ninguna palabra, es una celda negra
                        cell.classList.add('black'); // Asegura que la clase 'black' se aplique
                    }
                    crosswordGridElement.appendChild(cell);
                }
            }

            // Paso 5: Colocar los números de las pistas
            crosswordData.words.forEach(word => {
                const { row, col, number } = word.start;
                // Busca la celda correcta usando el índice basado en row y col.
                // gridWidth es el número de columnas, por lo que row * gridWidth te lleva al inicio de la fila,
                // y + col te lleva a la columna correcta. Sumamos 1 porque querySelectorAll es 1-indexed.
                const targetCell = crosswordGridElement.querySelector(`.grid-cell:nth-child(${row * gridWidth + col + 1})`);
                if (targetCell) {
                    let numberSpan = targetCell.querySelector('.number');
                    if (!numberSpan) {
                        numberSpan = document.createElement('span');
                        numberSpan.classList.add('number');
                        targetCell.insertBefore(numberSpan, targetCell.firstChild);
                    }
                    numberSpan.textContent = number;
                }
            });

            renderClues(); // Asegurarse de que las pistas se rendericen siempre
        }

        function renderClues() {
            acrossCluesElement.innerHTML = '';
            downCluesElement.innerHTML = '';

            const acrossClues = crosswordData.words.filter(word => word.direction === 'across')
                .sort((a, b) => a.number - b.number);
            const downClues = crosswordData.words.filter(word => word.direction === 'down')
                .sort((a, b) => a.number - b.number);
            
            acrossClues.forEach(word => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="font-semibold">${word.number}.</span> ${word.clue}`;
                li.dataset.number = word.number;
                li.dataset.direction = word.direction;
                li.addEventListener('click', () => highlightWord(word));
                acrossCluesElement.appendChild(li);
            });
            downClues.forEach(word => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="font-semibold">${word.number}.</span> ${word.clue}`;
                li.dataset.number = word.number;
                li.dataset.direction = word.direction;
                li.addEventListener('click', () => highlightWord(word));
                downCluesElement.appendChild(li);
            });
        }

        function highlightWord(wordToHighlight) {
            gridCells.forEach(input => {
                input.parentElement.classList.remove('active');
            });
            document.querySelectorAll('.clues-column li').forEach(li => {
                li.classList.remove('active');
            });
            
            activeWord = wordToHighlight;

            let { row, col } = wordToHighlight.start;
            const maxCols = gridWidth; // Usar gridWidth que ya está calculado
            for (let i = 0; i < wordToHighlight.word.length; i++) {
                const cellIndex = row * maxCols + col;
                const cellElement = crosswordGridElement.children[cellIndex];
                if (cellElement && cellElement.querySelector('input')) {
                    cellElement.classList.add('active');
                }
                if (wordToHighlight.direction === 'across') {
                    col++;
                } else {
                    row++;
                }
            }
            const clueElement = document.querySelector(`.clues-column li[data-number="${wordToHighlight.number}"][data-direction="${wordToHighlight.direction}"]`);
            if (clueElement) {
                clueElement.classList.add('active');
            }
        }

        function handleInput(event) {
            const input = event.target;
            input.value = input.value.toUpperCase();
            
            if (activeWord) {
                let { row, col } = activeWord.start;
                let currentIndex = -1;
                const maxCols = gridWidth;

                for (let i = 0; i < activeWord.word.length; i++) {
                    const cellIndex = row * maxCols + col;
                    const cellInput = crosswordGridElement.children[cellIndex].querySelector('input');
                    if (cellInput === input) {
                        currentIndex = i;
                        break;
                    }
                    if (activeWord.direction === 'across') {
                        col++;
                    } else {
                        row++;
                    }
                }

                if (currentIndex !== -1 && currentIndex < activeWord.word.length - 1) {
                    let nextInput = null;
                    let nextRow = activeWord.start.row;
                    let nextCol = activeWord.start.col;

                    if (activeWord.direction === 'across') {
                        nextCol += currentIndex + 1;
                    } else {
                        nextRow += currentIndex + 1;
                    }

                    const nextCellIndex = nextRow * maxCols + nextCol;
                    const nextCellElement = crosswordGridElement.children[nextCellIndex];
                    if (nextCellElement && nextCellElement.querySelector('input')) {
                        nextInput = nextCellElement.querySelector('input');
                        nextInput.focus();
                    }
                }
            } else {
                // Comportamiento de navegación por defecto si no hay palabra activa
                const row = parseInt(input.dataset.row);
                const col = parseInt(input.dataset.col);
                const maxCols = gridWidth;
                let nextCol = col + 1;
                let nextRow = row;
                
                // Buscar la siguiente celda jugable
                while (nextRow < gridHeight) {
                    if (nextCol >= maxCols) {
                        nextCol = 0;
                        nextRow++;
                        // Si nos movemos a una nueva fila, reiniciamos col para buscar desde el inicio de esa fila
                        if (nextRow >= gridHeight) break; // Evitar loop infinito si no hay más filas
                    }
                    const nextCellIndex = nextRow * maxCols + nextCol;
                    const nextCellElement = crosswordGridElement.children[nextCellIndex];
                    if (nextCellElement && nextCellElement.querySelector('input')) {
                        nextCellElement.querySelector('input').focus();
                        break;
                    }
                    nextCol++; // Avanzar a la siguiente columna
                }
            }
        }

        function handleFocus(event) {
            const focusedInput = event.target;
            const row = parseInt(focusedInput.dataset.row);
            const col = parseInt(focusedInput.dataset.col);

            // Desactivar highlighting de la palabra activa anterior
            if (activeWord) {
                let { row: prevRow, col: prevCol } = activeWord.start;
                const maxCols = gridWidth;
                for (let i = 0; i < activeWord.word.length; i++) {
                    const cellIndex = prevRow * maxCols + prevCol;
                    const cellElement = crosswordGridElement.children[cellIndex];
                    if (cellElement && cellElement.querySelector('input')) {
                        cellElement.classList.remove('active');
                    }
                    if (activeWord.direction === 'across') {
                        prevCol++;
                    } else {
                        prevRow++;
                    }
                }
            }

            const intersectingWords = crosswordData.words.filter(word => {
                const { row: startRow, col: startCol } = word.start;
                if (word.direction === 'across') {
                    return row === startRow && col >= startCol && col < (startCol + word.word.length);
                } else {
                    return col === startCol && row >= startRow && row < (startRow + word.word.length);
                }
            });

            if (intersectingWords.length > 0) {
                // Si la celda enfocada es parte de varias palabras, se resalta la primera encontrada.
                // Aquí podrías añadir lógica para que el usuario elija qué palabra activar si hay múltiples.
                highlightWord(intersectingWords[0]);
            } else {
                // Si la celda no es parte de ninguna palabra definida (esto no debería pasar en una celda jugable)
                gridCells.forEach(input => {
                    input.parentElement.classList.remove('active');
                });
                document.querySelectorAll('.clues-column li').forEach(li => {
                    li.classList.remove('active');
                });
                activeWord = null;
            }
        }

        function handleKeyDown(event) {
            const input = event.target;
            const row = parseInt(input.dataset.row);
            const col = parseInt(input.dataset.col);
            const maxCols = gridWidth;
            const maxRows = gridHeight; // Usar gridHeight

            let nextInput = null;
            let targetRow = row;
            let targetCol = col;

            // Navegación específica de la palabra activa
            if (activeWord) {
                if (activeWord.direction === 'across') {
                    if (event.key === 'ArrowRight') {
                        targetCol++;
                    } else if (event.key === 'ArrowLeft') {
                        targetCol--;
                    } else if (event.key === 'Backspace' && input.value === '') {
                        targetCol--;
                    }
                } else { // direction is 'down'
                    if (event.key === 'ArrowDown') {
                        targetRow++;
                    } else if (event.key === 'ArrowUp') {
                        targetRow--;
                    } else if (event.key === 'Backspace' && input.value === '') {
                        targetRow--;
                    }
                }
            } 
            // Navegación general si no hay palabra activa o si se usan otras flechas
            if (!activeWord || (event.key !== 'ArrowRight' && event.key !== 'ArrowLeft' && event.key !== 'ArrowDown' && event.key !== 'ArrowUp' && event.key !== 'Backspace' && event.key !== 'Delete')) {
                switch (event.key) {
                    case 'ArrowRight':
                        targetCol++;
                        break;
                    case 'ArrowLeft':
                        targetCol--;
                        break;
                    case 'ArrowDown':
                        targetRow++;
                        break;
                    case 'ArrowUp':
                        targetRow--;
                        break;
                    case 'Backspace':
                        if (input.value === '') { // Si la celda está vacía, retrocede
                            targetCol--; // Asumiendo que se mueve horizontalmente por defecto si no hay activeWord
                        } else { // Si tiene valor, solo borra el valor sin moverse
                            input.value = '';
                            return; // No prevenir el comportamiento por defecto de backspace en este caso
                        }
                        break;
                    case 'Delete':
                        input.value = '';
                        return; // No prevenir el comportamiento por defecto de delete
                    default:
                        // No es una tecla de navegación o borrado que necesitemos manejar
                        return;
                }
            }
            
            // Asegurarse de que el target esté dentro de los límites de la cuadrícula
            targetRow = Math.max(0, Math.min(targetRow, maxRows - 1));
            targetCol = Math.max(0, Math.min(targetCol, maxCols - 1));

            event.preventDefault(); // Previene el comportamiento por defecto de las flechas del navegador
            
            const targetCellIndex = targetRow * maxCols + targetCol;
            const targetCellElement = crosswordGridElement.children[targetCellIndex];
            
            if (targetCellElement) {
                nextInput = targetCellElement.querySelector('input');
            }

            if (nextInput) {
                nextInput.focus();
                // Si retrocedemos con Backspace, el cursor debería ir al final del texto en la celda anterior
                if (event.key === 'Backspace' && input.value === '') {
                    nextInput.selectionStart = nextInput.selectionEnd = nextInput.value.length;
                }
            }
        }


        function checkAnswers() {
            let allCorrect = true;
            crosswordData.words.forEach(word => {
                let { row, col } = word.start;
                let userAnswer = '';
                const maxCols = gridWidth;

                // Construir la respuesta del usuario para esta palabra
                for (let i = 0; i < word.word.length; i++) {
                    const cellIndex = row * maxCols + col;
                    const inputElement = crosswordGridElement.children[cellIndex].querySelector('input');
                    if (inputElement) {
                        userAnswer += inputElement.value.toUpperCase(); // Convertir a mayúsculas para la comparación
                    } else {
                        userAnswer += ' '; // Si no hay input (celda negra), añade un espacio (o algo que no coincida)
                    }
                    if (word.direction === 'across') {
                        col++;
                    } else {
                        row++;
                    }
                }

                // Comparar y aplicar clases
                if (userAnswer === word.word.toUpperCase()) {
                    let { row: r, col: c } = word.start;
                    for (let i = 0; i < word.word.length; i++) {
                        const cellIndex = r * maxCols + c;
                        const inputElement = crosswordGridElement.children[cellIndex].querySelector('input');
                        if (inputElement) {
                            inputElement.parentElement.classList.remove('incorrect');
                            inputElement.parentElement.classList.add('correct');
                        }
                        if (word.direction === 'across') {
                            c++;
                        } else {
                            r++;
                        }
                    }
                } else {
                    allCorrect = false;
                    let { row: r, col: c } = word.start;
                    for (let i = 0; i < word.word.length; i++) {
                        const cellIndex = r * maxCols + c;
                        const inputElement = crosswordGridElement.children[cellIndex].querySelector('input');
                        if (inputElement) {
                            inputElement.parentElement.classList.remove('correct');
                            inputElement.parentElement.classList.add('incorrect');
                        }
                        if (word.direction === 'across') {
                            c++;
                        } else {
                            r++;
                        }
                    }
                }
            });
            if (allCorrect) {
                showMessage('¡Felicidades!', '¡Has completado el crucigrama correctamente!');
            } else {
                showMessage('¡Sigue intentándolo!', 'Algunas respuestas son incorrectas. Las celdas marcadas en rojo necesitan revisión.');
            }
        }

        function clearGrid() {
            gridCells.forEach(input => {
                input.value = '';
                input.parentElement.classList.remove('correct', 'incorrect', 'active');
            });
            document.querySelectorAll('.clues-column li').forEach(li => {
                li.classList.remove('active');
            });
            activeWord = null; // Resetea la palabra activa
            showMessage('Crucigrama Limpiado', 'Todas las respuestas han sido borradas. ¡Puedes empezar de nuevo!');
        }

        function showSolution() {
            gridCells.forEach(input => {
                input.value = ''; // Limpia los inputs antes de mostrar la solución
                input.parentElement.classList.remove('correct', 'incorrect', 'active'); // Remueve cualquier estado previo
            });
            document.querySelectorAll('.clues-column li').forEach(li => {
                li.classList.remove('active');
            });
            activeWord = null; // Resetea la palabra activa
            
            const maxCols = gridWidth;

            crosswordData.words.forEach(word => {
                let { row, col } = word.start;
                for (let i = 0; i < word.word.length; i++) {
                    const cellIndex = row * maxCols + col;
                    const inputElement = crosswordGridElement.children[cellIndex].querySelector('input');
                    if (inputElement) {
                        inputElement.value = word.word[i].toUpperCase(); // Rellena con la letra correcta en mayúsculas
                        inputElement.parentElement.classList.add('correct'); // Opcional: marca como correctas visualmente
                    }
                    if (word.direction === 'across') {
                        col++;
                    } else {
                        row++;
                    }
                }
            });
            showMessage('Solución Mostrada', 'Aquí tienes las respuestas correctas. ¡Esperamos que hayas aprendido mucho!');
        }

        checkAnswersButton.addEventListener('click', checkAnswers);
        clearGridButton.addEventListener('click', clearGrid);
        showSolutionButton.addEventListener('click', showSolution);

        document.addEventListener('DOMContentLoaded', initializeGrid);
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registrado con éxito, alcance:', registration.scope);
                    })
                    .catch(err => {
                        console.log('Fallo el registro de ServiceWorker:', err);
                    });
            });
        }
    </script>
</body>
</html>
